---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import ServiceCard from '../components/ServiceCard.astro';
import CoverageMap from '../components/CoverageMap.astro';
import { t, get } from '../i18n/index';

const PHONE = '+79210974463';
const WA = `https://wa.me/79210974463`;
---

<BaseLayout title={t('site.title')} description={t('hero.lead')} lang={t('site.lang')}>
	<!-- Header -->
	<Header 
		title={t('site.title')} 
		servicesLabel={t('nav.services')} 
		workflowLabel={t('nav.workflow')}
		coverageLabel={t('nav.coverage')}
	/>

		<main>
			<!-- Hero Section -->
			<section class="hero">
				<div class="container">
					<div class="hero-content">
						<h1>{t('hero.title')}</h1>
						<p class="lead">{t('hero.lead')}</p>
						<div class="hero-cta">
							<a class="btn btn-primary" href={`tel:${PHONE}`}>ðŸ“ž {t('cta.call')}</a>
							<a class="btn btn-secondary" href={WA} target="_blank" rel="noopener">ðŸ’¬ {t('cta.whatsapp')}</a>
						</div>
					</div>
				</div>
			</section>

			<!-- Services Section -->
			<section id="services">
				<div class="container">
					<h2 class="section-title">{t('nav.services')}</h2>
					<div class="services-grid">
						<ServiceCard 
							title={t('services.items.0.title')}
							description={t('services.items.0.desc')}
							imageSrc="/images/mono.webp"
						/>
						<ServiceCard 
							title={t('services.items.1.title')}
							description={t('services.items.1.desc')}
							imageSrc="/images/poly.webp"
						/>
						<ServiceCard 
							title={t('services.items.2.title')}
							description={t('services.items.2.desc')}
							imageSrc="/images/toner.webp"
						/>
					</div>
				</div>
			</section>

			<!-- Brands Section -->
			<section class="brands">
				<div class="container">
					<p class="text-center text-muted mb-lg">{t('sections.brands.lead')}</p>
					<div class="brands-grid">
						{get('brands').map((brand: string) => (
							<div class="brand-item">{brand}</div>
						))}
					</div>
				</div>
			</section>

			<!-- Workflow (Promises + Process) -->
			<section id="workflow">
				<div class="container">
					<h2 class="section-title">{t('workflow.title')}</h2>
					<p class="section-subtitle">{t('workflow.lead')}</p>

					<div class="promises-grid">
						{get('workflow.promises').map((item: any) => (
							<article class="card promise">
								<h3 class="promise-title">{item.title}</h3>
								<p class="promise-desc">{item.desc}</p>
							</article>
						))}
					</div>

					<div class="process-grid">
						{get('workflow.steps').map((step: any, idx: number) => (
							<article class="card process-step">
								<div class="step-num" aria-hidden="true">{idx + 1}</div>
								<h3 class="process-title">{step.title}</h3>
								<p class="process-desc">{step.desc}</p>
							</article>
						))}
					</div>
				</div>
			</section>

			<!-- Coverage Zones (module) -->
			<CoverageMap
				title={t('coverage.title')}
				lead={t('coverage.lead')}
				sectionId="coverage"
			/>

			<!-- Contacts Section (hidden) -->
		</main>

		<!-- Footer -->
		<Footer title={t('site.title')} rightsLabel={t('footer.rights')} />

		<!-- Sticky CTA (Mobile) -->
		<div class="sticky-cta">
			<a class="btn btn-primary" href={`tel:${PHONE}`}>ðŸ“ž {t('cta.call')}</a>
			<a class="btn btn-secondary" href={WA} target="_blank" rel="noopener">ðŸ’¬ {t('cta.whatsapp')}</a>
		</div>

		<!-- Animations Script -->
		<script>
			// Intersection Observer Ð´Ð»Ñ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¹ Ð¿Ñ€Ð¸ ÑÐºÑ€Ð¾Ð»Ð»Ðµ
			if (typeof window !== 'undefined') {
				const observerOptions = {
					root: null,
					rootMargin: '0px',
					threshold: 0.1
				};

				const observer = new IntersectionObserver((entries) => {
					entries.forEach((entry) => {
						if (entry.isIntersecting) {
							entry.target.classList.add('animate-fade-in-up');
							observer.unobserve(entry.target);
						}
					});
				}, observerOptions);

				// ÐÐ°Ð±Ð»ÑŽÐ´Ð°ÐµÐ¼ Ð·Ð° Ð²ÑÐµÐ¼Ð¸ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ°Ð¼Ð¸ Ð¸ ÑÐµÐºÑ†Ð¸ÑÐ¼Ð¸
				document.addEventListener('DOMContentLoaded', () => {
					const elements = document.querySelectorAll('.card, .hero-content, .section-title, .brands-grid');
					elements.forEach((el, index) => {
						// Ð—Ð°Ð´ÐµÑ€Ð¶ÐºÐ° Ð´Ð»Ñ ÐºÐ°ÑÐºÐ°Ð´Ð½Ð¾Ð³Ð¾ ÑÑ„Ñ„ÐµÐºÑ‚Ð°
						if (el instanceof HTMLElement) {
							el.style.animationDelay = `${index * 0.1}s`;
						}
						observer.observe(el);
					});

					// Ð­Ñ„Ñ„ÐµÐºÑ‚Ñ‹ Ð´Ð»Ñ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐµÐº ÑƒÑÐ»ÑƒÐ³
					const serviceCardEls = document.querySelectorAll('.services-grid .card-feature');
					const firstServiceCard = serviceCardEls[0];
					const secondServiceCard = serviceCardEls[1];
					const body = document.body;
					if (firstServiceCard instanceof Element) {
						firstServiceCard.addEventListener('mouseenter', () => {
							body.classList.remove('cmy-mode');
							body.classList.add('grayscale-mode');
						});
						firstServiceCard.addEventListener('mouseleave', () => {
							body.classList.remove('grayscale-mode');
						});
					}

					// Ð­Ñ„Ñ„ÐµÐºÑ‚ CMY Ð¿Ñ€Ð¸ Ð½Ð°Ð²ÐµÐ´ÐµÐ½Ð¸Ð¸ Ð½Ð° Ð’Ð¢ÐžÐ Ð£Ð® ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÑƒ (Ð ÐµÐ¼Ð¾Ð½Ñ‚ Ð¿Ð¾Ð»Ð½Ð¾Ñ†Ð²ÐµÑ‚Ð½Ñ‹Ñ…)
					if (secondServiceCard instanceof Element) {
						secondServiceCard.addEventListener('mouseenter', () => {
							body.classList.remove('grayscale-mode');
							body.classList.add('cmy-mode');
						});
						secondServiceCard.addEventListener('mouseleave', () => {
							body.classList.remove('cmy-mode');
						});
					}
				});

				// ÐŸÐ»Ð°Ð²Ð½Ð¾Ðµ Ð¿Ð¾ÑÐ²Ð»ÐµÐ½Ð¸Ðµ header Ð¿Ñ€Ð¸ ÑÐºÑ€Ð¾Ð»Ð»Ðµ
				let lastScroll = 0;
				const header = document.querySelector('.site-header');
				
				window.addEventListener('scroll', () => {
					const currentScroll = window.pageYOffset;
					
					if (currentScroll > lastScroll && currentScroll > 100) {
						if (header instanceof HTMLElement) header.style.transform = 'translateY(-100%)';
					} else {
						if (header instanceof HTMLElement) header.style.transform = 'translateY(0)';
					}
					
					lastScroll = currentScroll;
				});

			}
		</script>
</BaseLayout>
